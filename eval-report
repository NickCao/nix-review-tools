#!/usr/bin/env ruby

require File.join(__dir__(), "lib/hydra")
require File.join(__dir__(), "lib/report")

abort "Usage: eval-report <id...>" unless ARGV[0]

ids = [];

# TODO : arguments parsing...
ARGV.each do |arg|
  ids << arg
end

# Combine all evals
evals = ids.map { |id| [id, Hydra::Eval.get(id, with_build_details: true)] }.to_h

puts Report::Eval.report(evals)
puts Report::Eval.failure_propagation(evals)
puts ""
# sneaky ad, but I'm being asked how I generate it!
puts "<sup>Generated by [eval-report](https://github.com/nix-community/nix-review-tools/blob/master/eval-report)</sup>"
puts ""
